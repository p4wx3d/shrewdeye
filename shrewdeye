#!/usr/bin/env python3

import os
import sys
import requests

def print_banner():
    RED = "\033[31m"
    GREEN = "\033[32m"
    YELLOW = "\033[33m"
    BLUE = "\033[34m"
    MAGENTA = "\033[35m"
    CYAN = "\033[36m"
    RESET = "\033[0m"

    print()
    print(f"{YELLOW}                     Coded by: p4wx3d                                  {RESET}")
    print(f"{CYAN}         █████                                             █████                             {RESET}")
    print(f"{CYAN}        ░░███                                             ░░███                              {RESET}")
    print(f"{GREEN}  █████  ░███████   ████████   ██████  █████ ███ █████  ███████   ██████  █████ ████  ██████ {RESET}")
    print(f"{GREEN} ███░░   ░███░░███ ░░███░░███ ███░░███░░███ ░███░░███  ███░░███  ███░░███░░███ ░███  ███░░███ {RESET}")
    print(f"{GREEN}░░█████  ░███ ░███  ░███ ░░░ ░███████  ░███ ░███ ░███ ░███ ░███ ░███████  ░███ ░███ ░███████ {RESET}")
    print(f"{GREEN} ░░░░███ ░███ ░███  ░███     ░███░░░   ░░███████████  ░███ ░███ ░███░░░   ░███ ░███ ░███░░░  {RESET}")
    print(f"{GREEN} ██████  ████ █████ █████    ░░██████   ░░████░████   ░░████████░░██████  ░░███████ ░░██████ {RESET}")
    print(f"{CYAN}░░░░░░  ░░░░ ░░░░░ ░░░░░      ░░░░░░     ░░░░ ░░░░     ░░░░░░░░  ░░░░░░    ░░░░░███  ░░░░░░  {RESET}")
    print(f"{CYAN}                                                                           ███ ░███          {RESET}")
    print(f"{CYAN}                                                                          ░░██████           {RESET}")
    print(f"{CYAN}                                                                           ░░░░░░            {RESET}")

def print_message():
    MAGENTA = "\033[35m"
    RESET = "\033[0m"
    print("\n")
    print(f"{MAGENTA}Subdomains collector from shrewdeye.app. Just provide a file with all the domains.{RESET}")
    print("\n")

def download_file(url, filename):
    response = requests.get(url)
    if response.status_code == 200:
        with open(filename, 'wb') as file:
            file.write(response.content)
        print(f"Downloaded: {filename}")
    else:
        print(f"Failed to download {filename}. Status code: {response.status_code}")

def main(domains_file, separate_files):
    if separate_files:
        # Create the output directory if it doesn't exist
        output_directory = "shrewdeye_subdomains"
        if not os.path.exists(output_directory):
            os.makedirs(output_directory)

    # Read domains from the specified file
    with open(domains_file, 'r') as file:
        domains = [line.strip() for line in file.readlines()]

    if separate_files:
        # Download each domain's subdomain file separately
        for domain in domains:
            if domain:  # Ensure the domain is not empty
                url = f"https://shrewdeye.app/domains/{domain}.txt"
                filename = os.path.join(output_directory, f"{domain}.txt")
                download_file(url, filename)
    else:
        # Compile all subdomains into a single file
        all_subdomains_filename = "shrewdeye_all_domains.txt"
        with open(all_subdomains_filename, 'wb') as all_file:
            for domain in domains:
                if domain:  # Ensure the domain is not empty
                    url = f"https://shrewdeye.app/domains/{domain}.txt"
                    response = requests.get(url)
                    if response.status_code == 200:
                        all_file.write(response.content)
                        print(f"Downloaded: {domain}.txt")
                    else:
                        print(f"Failed to download {domain}.txt. Status code: {response.status_code}")
        print(f"All subdomains compiled into: {all_subdomains_filename}")

if __name__ == "__main__":
    print_banner()
    print_message()

    if len(sys.argv) != 2:
        print("Usage: ./shrewdeye <filename>")
        sys.exit(1)

    domains_file = sys.argv[1]

    # Ask user for preference
    separate_choice = input("Do you want to keep each domain file separately? (y/n): ").strip().lower()
    separate_files = separate_choice == 'y'

    main(domains_file, separate_files)
